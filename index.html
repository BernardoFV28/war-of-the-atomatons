<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>War of automatons</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; color: white; font-family: 'Segoe UI', sans-serif; user-select: none; }
        canvas { display: block; }
        #ui-layer { position: absolute; top: 10px; left: 10px; pointer-events: none; z-index: 5; }
        .stat-box { background: rgba(0,0,0,0.8); padding: 8px 15px; border-radius: 4px; margin-bottom: 5px; border-left: 4px solid #00d2ff; font-weight: bold; }
        #mission-hud { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(255, 166, 0, 0.2); border: 2px solid orange; padding: 10px 25px; border-radius: 50px; text-align: center; min-width: 300px; display: none; z-index: 5; }
        #boss-hud { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); width: 60%; display: none; flex-direction: column; align-items: center; z-index: 5; }
        #boss-bar-bg { width: 100%; height: 15px; background: #333; border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
        #boss-bar-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #ff0000, #ff8800); transition: width 0.2s; }
        #menu-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .hidden { display: none !important; }
        #shop-container { display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .upgrade-card { background-color: #222; border: 2px solid #444; padding: 15px; width: 160px; text-align: center; cursor: pointer; border-radius: 10px; transition: 0.2s; pointer-events: all; }
        .upgrade-card:hover { border-color: #00d2ff; transform: scale(1.05); }
        .cost { color: #ffd700; font-weight: bold; }
        .btn { background: #0077ff; border: none; padding: 15px 40px; color: white; font-size: 1.2rem; cursor: pointer; border-radius: 50px; margin-top: 20px; pointer-events: all; }
        #toast-container { position: absolute; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #002244; border-left: 5px solid gold; padding: 10px 20px; animation: slide 0.3s; }
        @keyframes slide { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="stat-box">üõ°Ô∏è N√≠vel: <span id="hud-level">1</span></div>
        <div class="stat-box">‚ú® XP: <span id="hud-xp">0</span> / <span id="hud-next-xp">100</span></div>
        <div class="stat-box" style="border-color: #ff0055">‚ù§Ô∏è HP: <span id="hud-hp">100</span></div>
        <div class="stat-box" style="border-color: gold">üèÜ Pontos: <span id="hud-sp">0</span></div>
    </div>

    <div id="mission-hud">
        <b id="mission-title" style="color: orange;"></b>
        <div id="mission-timer"></div>
    </div>

    <div id="boss-hud">
        <b style="color: red; margin-bottom: 5px;">CHEFE DA √ÅREA</b>
        <div id="boss-bar-bg"><div id="boss-bar-fill"></div></div>
    </div>

    <div id="toast-container"></div>

    <div id="menu-overlay">
        <div id="start-screen">
            <h1 style="font-size: 3rem; color: #00d2ff; margin-bottom: 0;">GUERRA DOS AUTOMATOS</h1>
            <p style="text-align: center;">Use as bordas para se teleportar!<br>WASD para mover | Mouse para atirar</p>
            <button class="btn" id="btn-start">INICIAR OPERA√á√ÉO</button>
        </div>

        <div id="shop-screen" class="hidden">
            <h2 style="color: gold;">LOJA DE UPGRADES</h2>
            <div id="shop-container">
                <div class="upgrade-card" data-upgrade="damage"><h3>Dano</h3><p>Tiros mais fortes</p><p class="cost">1 Ponto</p></div>
                <div class="upgrade-card" data-upgrade="speed"><h3>Motor</h3><p>Velocidade +</p><p class="cost">1 Ponto</p></div>
                <div class="upgrade-card" data-upgrade="firerate"><h3>Cad√™ncia</h3><p>Atira r√°pido</p><p class="cost">2 Pontos</p></div>
                <div class="upgrade-card" data-upgrade="multishot"><h3>Multi-Tiro</h3><p>+ Canh√µes</p><p class="cost">5 Pontos</p></div>
                <div class="upgrade-card" data-upgrade="heal"><h3>Reparo</h3><p>Cura Total</p><p class="cost">1 Ponto</p></div>
            </div>
            <button class="btn" id="btn-close-shop">CONTINUAR</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
/** ASSETS COM FALLBACK **/
const assets = {
    player: new Image(), bullet: new Image(), enemy: new Image(), 
    boss: new Image(), wall: new Image(), floor: new Image(), ammo: new Image()
};
assets.player.src = 'assets/player.png';
assets.bullet.src = 'assets/bullet.png';
assets.enemy.src = 'assets/enemy_robot.png';
assets.boss.src = 'assets/boss_robot.png';
assets.wall.src = 'assets/scrap_block.png';
assets.floor.src = 'assets/dungeon_floor.png';
assets.ammo.src = 'assets/ammo.png';

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

class Boss {
    constructor(level) {
        this.x = canvas.width / 2;
        this.y = -100;
        this.targetY = 150;
        this.maxHp = 500 + (level * 200);
        this.hp = this.maxHp;
        this.size = 60;
        this.attackTimer = 0;
    }
    update(game) {
        if (this.y < this.targetY) this.y += 2;
        this.x += Math.sin(Date.now() / 1000) * 4;
        this.attackTimer++;
        if (this.attackTimer > 60) {
            for(let i=-2; i<=2; i++) {
                const angle = Math.PI/2 + (i * 0.3);
                game.bullets.push({x: this.x, y: this.y + 40, vx: Math.cos(angle)*6, vy: Math.sin(angle)*6, type: 'enemy', damage: 10});
            }
            this.attackTimer = 0;
        }
    }
    draw(ctx) {
        if(assets.boss.complete && assets.boss.naturalWidth !== 0) {
            ctx.drawImage(assets.boss, this.x - this.size, this.y - this.size, this.size * 2, this.size * 2);
        } else {
            ctx.fillStyle = 'red'; ctx.fillRect(this.x - this.size, this.y - this.size, this.size * 2, this.size * 2);
        }
    }
}

class Game {
    constructor() {
        this.player = { x:0, y:0, size:20, speed:5, baseSpeed:5, hp:100, maxHp:100, xp:0, xpToNext:100, level:1, sp:0, dmg:20, fr:20, ms:1, cd:0 };
        this.bullets = []; this.enemies = []; this.env = []; this.drops = [];
        this.boss = null; this.isRunning = false; this.isPaused = false;
        this.input = { keys: {}, mouseX:0, mouseY:0, down: false };
        this.mission = null; this.missionTime = 0; this.missionCd = 500;
        this.multipliers = { eSpeed: 1, eHp: 1, xp: 1, pDmg: 1 };
        this.setupListeners();
    }

    setupListeners() {
        window.addEventListener('keydown', e => this.input.keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => this.input.keys[e.key.toLowerCase()] = false);
        window.addEventListener('mousemove', e => { this.input.mouseX = e.clientX; this.input.mouseY = e.clientY; });
        window.addEventListener('mousedown', () => this.input.down = true);
        window.addEventListener('mouseup', () => this.input.down = false);
        document.getElementById('btn-start').addEventListener('click', () => this.start());
        document.getElementById('btn-close-shop').addEventListener('click', () => this.toggleShop(false));
        document.querySelectorAll('.upgrade-card').forEach(card => {
            card.addEventListener('click', () => this.buy(card.dataset.upgrade));
        });
    }

    start() {
        this.player.x = canvas.width/2; this.player.y = canvas.height/2;
        this.player.hp = 100; this.enemies = []; this.bullets = []; this.drops = [];
        this.generateMap();
        this.isRunning = true;
        document.getElementById('menu-overlay').classList.add('hidden');
        this.loop();
    }

    generateMap() {
        this.env = [];
        for(let i=0; i<6; i++) {
            this.env.push({t:'wall', x: Math.random()*(canvas.width-100)+50, y: Math.random()*(canvas.height-100)+50, w:64, h:64});
        }
    }

    loop() {
        if (!this.isRunning || this.isPaused) return;

        ctx.fillStyle = '#0a0a0a';
        ctx.fillRect(0,0,canvas.width, canvas.height);

        // L√≥gica de spawn do Boss (N√≠vel 5, 10...)
        if (this.player.level % 5 === 0 && !this.boss) {
            this.boss = new Boss(this.player.level);
            this.mission = null;
            document.getElementById('boss-hud').style.display = 'flex';
        }

        if (this.boss) {
            this.boss.update(this);
            this.boss.draw(ctx);
            document.getElementById('boss-bar-fill').style.width = (this.boss.hp/this.boss.maxHp)*100 + '%';
        } else {
            if(Math.random() < 0.02) this.spawnEnemy();
            this.updateMissions();
            document.getElementById('boss-hud').style.display = 'none';
        }

        this.updatePlayer();
        this.updateBullets();
        this.updateEnemies();
        this.updateEnvironment();
        this.updateDrops();
        this.updateUI();

        requestAnimationFrame(() => this.loop());
    }

    spawnEnemy() {
        const side = Math.floor(Math.random()*4);
        let x, y;
        if(side===0) { x=Math.random()*canvas.width; y=-30; }
        else if(side===1) { x=canvas.width+30; y=Math.random()*canvas.height; }
        else if(side===2) { x=Math.random()*canvas.width; y=canvas.height+30; }
        else { x=-30; y=Math.random()*canvas.height; }
        this.enemies.push({ x, y, hp: 40*this.multipliers.eHp, s: (1.5 + Math.random())*this.multipliers.eSpeed });
    }

    updatePlayer() {
        const p = this.player;
        if(this.input.keys['w']) p.y -= p.speed;
        if(this.input.keys['s']) p.y += p.speed;
        if(this.input.keys['a']) p.x -= p.speed;
        if(this.input.keys['d']) p.x += p.speed;

        // Teleporte
        if (p.x < 0) p.x = canvas.width; else if (p.x > canvas.width) p.x = 0;
        if (p.y < 0) p.y = canvas.height; else if (p.y > canvas.height) p.y = 0;

        if(p.cd > 0) p.cd--;
        if(this.input.down && p.cd <= 0) {
            const angle = Math.atan2(this.input.mouseY - p.y, this.input.mouseX - p.x);
            this.bullets.push({x: p.x, y: p.y, vx: Math.cos(angle)*10, vy: Math.sin(angle)*10, type:'player', damage: p.dmg});
            p.cd = p.fr;
        }

        ctx.fillStyle = '#00d2ff';
        if(assets.player.complete && assets.player.naturalWidth !== 0) ctx.drawImage(assets.player, p.x-20, p.y-20, 40, 40);
        else ctx.fillRect(p.x-15, p.y-15, 30, 30);
    }

    updateEnemies() {
        for(let i=this.enemies.length-1; i>=0; i--) {
            const e = this.enemies[i];
            const angle = Math.atan2(this.player.y - e.y, this.player.x - e.x);
            e.x += Math.cos(angle) * e.s;
            e.y += Math.sin(angle) * e.s;

            if(assets.enemy.complete && assets.enemy.naturalWidth !== 0) ctx.drawImage(assets.enemy, e.x-20, e.y-20, 40, 40);
            else { ctx.fillStyle = 'green'; ctx.fillRect(e.x-15, e.y-15, 30, 30); }

            if(Math.hypot(this.player.x-e.x, this.player.y-e.y) < 30) {
                this.player.hp -= 0.5;
                if(this.player.hp <= 0) { this.isRunning = false; alert("Fim de Jogo!"); location.reload(); }
            }
        }
    }

    updateBullets() {
        for(let i=this.bullets.length-1; i>=0; i--) {
            const b = this.bullets[i];
            b.x += b.vx; b.y += b.vy;
            ctx.fillStyle = b.type === 'player' ? 'yellow' : 'red';
            ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, Math.PI*2); ctx.fill();

            if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height) { this.bullets.splice(i,1); continue; }

            if(b.type === 'player') {
                if(this.boss && Math.hypot(b.x-this.boss.x, b.y-this.boss.y) < this.boss.size) {
                    this.boss.hp -= b.damage; this.bullets.splice(i,1);
                    if(this.boss.hp <= 0) { this.boss = null; this.player.xp += 500; this.toast("BOSS DERROTADO!"); this.checkLvl(); }
                    continue;
                }
                this.enemies.forEach((e, ei) => {
                    if(Math.hypot(b.x-e.x, b.y-e.y) < 25) {
                        e.hp -= b.damage; this.bullets.splice(i, 1);
                        if(e.hp <= 0) { this.enemies.splice(ei,1); this.player.xp += 25; this.checkLvl(); }
                    }
                });
            }
        }
    }

    updateEnvironment() {
        this.env.forEach(w => {
            if(assets.wall.complete && assets.wall.naturalWidth !== 0) ctx.drawImage(assets.wall, w.x, w.y, w.w, w.h);
            else { ctx.fillStyle = '#444'; ctx.fillRect(w.x, w.y, w.w, w.h); }
        });
    }

    updateDrops() {
        if(Math.random() < 0.001) this.drops.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height});
        this.drops.forEach((d, i) => {
            ctx.fillStyle = 'pink'; ctx.fillRect(d.x-10, d.y-10, 20, 20);
            if(Math.hypot(this.player.x-d.x, this.player.y-d.y) < 30) { this.player.hp = Math.min(100, this.player.hp+20); this.drops.splice(i,1); }
        });
    }

    checkLvl() {
        if(this.player.xp >= this.player.xpToNext) {
            this.player.level++; this.player.xp = 0; this.player.sp++;
            this.toast("LEVEL UP!"); this.toggleShop(true);
        }
    }

    updateMissions() {
        if(!this.mission && --this.missionCd <= 0) {
            this.mission = { t: "SOBREVIVA", d: 500 };
            this.toast("MISS√ÉO: SOBREVIVA!");
        }
    }

    buy(t) {
        if(this.player.sp > 0) {
            this.player.sp--;
            if(t==='damage') this.player.dmg += 10;
            if(t==='speed') this.player.speed += 1;
            if(t==='heal') this.player.hp = 100;
            this.toggleShop(false);
        }
    }

    toggleShop(s) { this.isPaused = s; document.getElementById('menu-overlay').classList.toggle('hidden', !s); document.getElementById('shop-screen').classList.toggle('hidden', !s); document.getElementById('start-screen').classList.add('hidden'); if(!s) this.loop(); }
    toast(m) { const d = document.createElement('div'); d.className = 'toast'; d.innerText = m; document.getElementById('toast-container').appendChild(d); setTimeout(() => d.remove(), 3000); }
    updateUI() { document.getElementById('hud-level').innerText = this.player.level; document.getElementById('hud-xp').innerText = this.player.xp; document.getElementById('hud-hp').innerText = Math.floor(this.player.hp); document.getElementById('hud-sp').innerText = this.player.sp; }
}

const game = new Game();
</script>
</body>
</html>


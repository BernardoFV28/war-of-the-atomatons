<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Robot Survivors: Biomes Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: #00d2ff; font-family: 'Courier New', monospace; }
        canvas { display: block; image-rendering: pixelated; } /* Garante que sua Pixel Art fique nítida */
        
        #ui-layer { position: absolute; top: 20px; left: 20px; pointer-events: none; z-index: 10; }
        .stat { background: rgba(0, 10, 30, 0.8); padding: 10px; border: 1px solid #00d2ff; margin-bottom: 5px; }
        
        #biome-announcement { 
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 3rem; font-weight: bold; text-transform: uppercase;
            text-shadow: 0 0 20px #00d2ff; opacity: 0; transition: 2s; pointer-events: none;
            z-index: 50; text-align: center;
        }
        
        .glitch { animation: glitch-anim 0.2s infinite; }
        @keyframes glitch-anim {
            0% { transform: translate(-50%, -50%) skew(0deg); }
            20% { transform: translate(-52%, -48%) skew(10deg); color: #ff00ff; }
            40% { transform: translate(-48%, -52%) skew(-10deg); color: #00ffff; }
            100% { transform: translate(-50%, -50%) skew(0deg); }
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="stat">BIOMA: <span id="biome-name">Depósito de Sucata</span></div>
        <div class="stat">TEMPO: <span id="game-timer">00:00</span></div>
        <div class="stat">HP: <span id="hp-count">100</span></div>
    </div>

    <div id="biome-announcement">NOVO SETOR DETECTADO</div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

/** CARREGAMENTO DE ASSETS **/
const assets = {
    player: new Image(),
    enemy: new Image(),
    // Biomas
    bg_scrapyard: new Image(),
    bg_neon: new Image(),
    bg_cryo: new Image(),
    bg_cathedral: new Image(),
    bg_glitch: new Image()
};

assets.player.src = 'assets/player.png';
assets.enemy.src = 'assets/enemy_robot.png';
assets.bg_scrapyard.src = 'assets/dungeon_floor.png';
assets.bg_neon.src = 'assets/bg_neon.png';
assets.bg_cryo.src = 'assets/bg_cryo.png';
assets.bg_cathedral.src = 'assets/bg_cathedral.png';
assets.bg_glitch.src = 'assets/bg_glitch.png';

/** DEFINIÇÃO DOS BIOMAS **/
const biomes = {
    scrapyard: { name: "Depósito de Sucata", img: assets.bg_scrapyard, speedMod: 1, friction: 0.15, color: "#5d4037" },
    neon: { name: "Rede de Fibra Neon", img: assets.bg_neon, speedMod: 1.5, friction: 0.1, color: "#00d2ff" },
    cryo: { name: "Laboratório Criogênico", img: assets.bg_cryo, speedMod: 0.8, friction: 0.02, color: "#ffffff" },
    cathedral: { name: "Catedral do Silício", img: assets.bg_cathedral, speedMod: 1, friction: 0.15, color: "#ffd700" },
    glitch: { name: "Vazio do Código", img: assets.bg_glitch, speedMod: 1.2, friction: 0.1, color: "#ff00ff" }
};

let currentPlayer = { x: 0, y: 0, vx: 0, vy: 0, hp: 100, speed: 5 };
let game = {
    timer: 0,
    currentBiome: biomes.scrapyard,
    enemies: [],
    lastBiomeUpdate: 0
};

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

const keys = {};
window.onkeydown = e => keys[e.key.toLowerCase()] = true;
window.onkeyup = e => keys[e.key.toLowerCase()] = false;

function announceBiome(name) {
    const el = document.getElementById('biome-announcement');
    el.innerText = name;
    el.style.opacity = 1;
    if(name === "Vazio do Código") el.classList.add('glitch');
    setTimeout(() => { el.style.opacity = 0; }, 3000);
}

function updateBiome() {
    const minutes = game.timer / 3600;
    let nextBiome = biomes.scrapyard;

    if (minutes > 4) nextBiome = biomes.glitch;
    else if (minutes > 3) nextBiome = biomes.cathedral;
    else if (minutes > 2) nextBiome = biomes.cryo;
    else if (minutes > 1) nextBiome = biomes.neon;

    if (nextBiome !== game.currentBiome) {
        game.currentBiome = nextBiome;
        document.getElementById('biome-name').innerText = nextBiome.name;
        announceBiome(nextBiome.name);
    }
}

function loop() {
    game.timer++;
    updateBiome();

    // Fundo com scroll (Tilling)
    ctx.imageSmoothingEnabled = false; // Essencial para Pixel Art
    if (game.currentBiome.img.complete) {
        const pattern = ctx.createPattern(game.currentBiome.img, 'repeat');
        ctx.fillStyle = pattern;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    } else {
        ctx.fillStyle = "#111";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    // Movimentação com Inércia (afetada pelo bioma)
    let ax = 0, ay = 0;
    if(keys['w']) ay = -1; if(keys['s']) ay = 1;
    if(keys['a']) ax = -1; if(keys['d']) ax = 1;

    currentPlayer.vx += ax * currentPlayer.speed * game.currentBiome.speedMod * 0.1;
    currentPlayer.vy += ay * currentPlayer.speed * game.currentBiome.speedMod * 0.1;
    
    // Aplica fricção do bioma
    currentPlayer.vx *= (1 - game.currentBiome.friction);
    currentPlayer.vy *= (1 - game.currentBiome.friction);

    currentPlayer.x += currentPlayer.vx;
    currentPlayer.y += currentPlayer.vy;

    // Desenha Player
    ctx.drawImage(assets.player, currentPlayer.x - 25, currentPlayer.y - 25, 50, 50);

    // Relógio HUD
    const secs = Math.floor((game.timer / 60) % 60);
    const mins = Math.floor(game.timer / 3600);
    document.getElementById('game-timer').innerText = 
        `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

    requestAnimationFrame(loop);
}

// Iniciar quando as imagens principais carregarem
assets.bg_scrapyard.onload = () => {
    currentPlayer.x = canvas.width/2;
    currentPlayer.y = canvas.height/2;
    loop();
};
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>War of the Automatons - Enhanced</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: 'Segoe UI', sans-serif; user-select: none; }
        canvas { display: block; }
        
        #ui-layer { position: absolute; top: 15px; left: 15px; pointer-events: none; z-index: 5; }
        .stat-box { background: rgba(0, 10, 20, 0.8); padding: 8px 15px; border-radius: 5px; margin-bottom: 5px; border-left: 4px solid #00d2ff; }

        #menu-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; overflow-y: auto; padding: 20px; }
        .hidden { display: none !important; }
        
        #shop-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 15px; 
            width: 90%; 
            max-width: 1000px;
            margin-top: 20px; 
        }

        .upgrade-card {
            background: #111; border: 2px solid #333; padding: 15px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            cursor: pointer; border-radius: 10px; transition: 0.2s;
            min-height: 180px;
        }
        .upgrade-card:hover { border-color: #00d2ff; background: #1a1a1a; transform: translateY(-5px); }
        .upgrade-card h3 { font-size: 1rem; margin: 5px 0; color: #00d2ff; }
        .upgrade-card p { font-size: 0.75rem; color: #aaa; flex-grow: 1; }
        .cost { color: #ffd700; font-weight: bold; margin-top: 10px; }

        .btn { background: #00d2ff; border: none; padding: 15px 40px; color: #000; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="stat-box">LEVEL: <span id="hud-level">1</span></div>
        <div class="stat-box">HP: <span id="hud-hp">100</span> / <span id="hud-max-hp">100</span></div>
        <div class="stat-box">SP (PONTOS): <span id="shop-points-hud">0</span></div>
    </div>

    <div id="menu-overlay">
        <div id="start-screen">
            <h1>War of the Automatons</h1>
            <center><button class="btn" onclick="game.start()">INICIAR MISSÃO</button></center>
        </div>

        <div id="shop-screen" class="hidden">
            <h2 style="margin:0;">SISTEMA DE UPGRADES</h2>
            <p style="color: gold;">Skill Points Disponíveis: <span id="shop-points">0</span></p>
            <div id="shop-container">
                <div class="upgrade-card" onclick="game.handleUpgrade('damage')"><h3>DANO</h3><p>Aumenta o poder das balas.</p><p class="cost">1 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('speed')"><h3>AGILIDADE</h3><p>Mova-se mais rápido.</p><p class="cost">1 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('firerate')"><h3>CADÊNCIA</h3><p>Atire mais rápido.</p><p class="cost">2 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('multishot')"><h3>MULTI-TIRO</h3><p>+1 Bala por vez.</p><p class="cost">5 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('heal')"><h3>REPARO</h3><p>Cura 50% de HP.</p><p class="cost">1 SP</p></div>
                
                <div class="upgrade-card" onclick="game.handleUpgrade('maxhp')"><h3>BLINDAGEM</h3><p>Aumenta HP Máximo em 50.</p><p class="cost">2 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('bulletsize')"><h3>CALIBRE</h3><p>Balas maiores e mais fáceis de acertar.</p><p class="cost">2 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('vampirism')"><h3>NANO-DRENAGEM</h3><p>Chance de curar 1 HP ao matar inimigos.</p><p class="cost">4 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('piercing')"><h3>PERFURANTE</h3><p>Balas atravessam o primeiro inimigo.</p><p class="cost">6 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('crit')"><h3>CRÍTICO</h3><p>10% de chance de causar dano triplo.</p><p class="cost">3 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('knockback')"><h3>IMPACTO</h3><p>Empurra inimigos para longe ao acertar.</p><p class="cost">3 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('xpboost')"><h3>APRENDIZADO</h3><p>Ganha 25% mais XP.</p><p class="cost">3 SP</p></div>
                <div class="upgrade-card" onclick="game.handleUpgrade('shield')"><h3>ESCUDO AUX.</h3><p>Reduz dano recebido em 15%.</p><p class="cost">4 SP</p></div>
            </div>
            <center><button class="btn" onclick="game.toggleShop()">VOLTAR À LUTA</button></center>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const assets = {
    player: new Image(), bullet: new Image(), enemy: new Image(), boss: new Image()
};
// Certifique-se que esses arquivos existem na pasta assets/
assets.player.src = 'assets/player.png';
assets.bullet.src = 'assets/bullet.png';
assets.enemy.src = 'assets/enemy_robot.png';
assets.boss.src = 'assets/boss_robot.png';

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

class Game {
    constructor() {
        this.player = {
            x: 0, y: 0, hp: 100, maxHp: 100, sp: 0, lvl: 1, xp: 0, nextXp: 100,
            dmg: 15, speed: 5, fr: 20, ms: 1, bSize: 8, 
            vamp: 0, pierce: false, crit: 0, knock: 0, xpm: 1, def: 1
        };
        this.enemies = []; this.bullets = []; this.running = false; this.paused = false;
        this.keys = {}; this.mouse = { x: 0, y: 0, down: false };
        this.setupListeners();
    }

    setupListeners() {
        window.onkeydown = e => this.keys[e.key.toLowerCase()] = true;
        window.onkeyup = e => this.keys[e.key.toLowerCase()] = false;
        window.onmousemove = e => { this.mouse.x = e.clientX; this.mouse.y = e.clientY; };
        window.onmousedown = () => this.mouse.down = true;
        window.onmouseup = () => this.mouse.down = false;
    }

    start() {
        this.player.x = canvas.width/2; this.player.y = canvas.height/2;
        this.running = true;
        document.getElementById('menu-overlay').classList.add('hidden');
        this.loop();
    }

    toggleShop() {
        this.paused = !this.paused;
        document.getElementById('menu-overlay').classList.toggle('hidden', !this.paused);
        document.getElementById('shop-screen').classList.toggle('hidden', !this.paused);
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('shop-points').innerText = this.player.sp;
        if(!this.paused) this.loop();
    }

    handleUpgrade(type) {
        const p = this.player;
        const costs = { damage:1, speed:1, firerate:2, multishot:5, heal:1, maxhp:2, bulletsize:2, vampirism:4, piercing:6, crit:3, knockback:3, xpboost:3, shield:4 };
        
        if (p.sp >= costs[type]) {
            p.sp -= costs[type];
            if(type === 'damage') p.dmg += 10;
            if(type === 'speed') p.speed += 0.8;
            if(type === 'firerate') p.fr = Math.max(5, p.fr - 3);
            if(type === 'multishot') p.ms++;
            if(type === 'heal') p.hp = Math.min(p.maxHp, p.hp + p.maxHp/2);
            if(type === 'maxhp') { p.maxHp += 50; p.hp += 50; }
            if(type === 'bulletsize') p.bSize += 4;
            if(type === 'vampirism') p.vamp += 0.05;
            if(type === 'piercing') p.pierce = true;
            if(type === 'crit') p.crit += 0.1;
            if(type === 'knockback') p.knock += 2;
            if(type === 'xpboost') p.xpm += 0.25;
            if(type === 'shield') p.def *= 0.85;

            document.getElementById('shop-points').innerText = p.sp;
            document.getElementById('shop-points-hud').innerText = p.sp;
        }
    }

    loop() {
        if (!this.running || this.paused) return;
        ctx.fillStyle = '#050505'; ctx.fillRect(0,0,canvas.width, canvas.height);

        this.updatePlayer();
        this.updateEnemies();
        this.updateBullets();
        this.updateUI();

        requestAnimationFrame(() => this.loop());
    }

    updatePlayer() {
        const p = this.player;
        if(this.keys['w']) p.y -= p.speed;
        if(this.keys['s']) p.y += p.speed;
        if(this.keys['a']) p.x -= p.speed;
        if(this.keys['d']) p.x += p.speed;

        if(this.cd > 0) this.cd--;
        if(this.mouse.down && (this.cd <= 0 || !this.cd)) {
            for(let i=0; i<p.ms; i++) {
                const angle = Math.atan2(this.mouse.y - p.y, this.mouse.x - p.x) + (i*0.1 - (p.ms-1)*0.05);
                this.bullets.push({ x:p.x, y:p.y, vx:Math.cos(angle)*12, vy:Math.sin(angle)*12, p: p.pierce });
            }
            this.cd = p.fr;
        }
        this.drawImg(assets.player, p.x, p.y, 40, '#00d2ff');
    }

    updateEnemies() {
        if(Math.random() < 0.02) {
            this.enemies.push({ x: Math.random()*canvas.width, y: -20, hp: 40 + (this.player.lvl*10) });
        }
        this.enemies.forEach((e, i) => {
            const angle = Math.atan2(this.player.y - e.y, this.player.x - e.x);
            e.x += Math.cos(angle) * 2; e.y += Math.sin(angle) * 2;
            this.drawImg(assets.enemy, e.x, e.y, 35, 'red');

            if(Math.hypot(this.player.x-e.x, this.player.y-e.y) < 30) {
                this.player.hp -= 0.5 * this.player.def;
                if(this.player.hp <= 0) location.reload();
            }
        });
    }

    updateBullets() {
        const p = this.player;
        for(let i=this.bullets.length-1; i>=0; i--) {
            const b = this.bullets[i];
            b.x += b.vx; b.y += b.vy;
            ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(b.x, b.y, p.bSize, 0, Math.PI*2); ctx.fill();

            this.enemies.forEach((e, ei) => {
                if(Math.hypot(b.x-e.x, b.y-e.y) < 25) {
                    let damage = p.dmg;
                    if(Math.random() < p.crit) damage *= 3;
                    e.hp -= damage;
                    
                    const angle = Math.atan2(e.y - b.y, e.x - b.x);
                    e.x += Math.cos(angle) * p.knock; e.y += Math.sin(angle) * p.knock;

                    if(!b.p) this.bullets.splice(i, 1);
                    if(e.hp <= 0) {
                        this.enemies.splice(ei, 1);
                        p.xp += 20 * p.xpm;
                        if(Math.random() < p.vamp) p.hp = Math.min(p.maxHp, p.hp + 1);
                        if(p.xp >= p.nextXp) {
                            p.lvl++; p.sp++; p.xp = 0; p.nextXp *= 1.2;
                            this.toggleShop();
                        }
                    }
                }
            });
            if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height) this.bullets.splice(i,1);
        }
    }

    drawImg(img, x, y, size, fallback) {
        if(img.complete && img.naturalWidth !== 0) {
            ctx.drawImage(img, x - size/2, y - size/2, size, size);
        } else {
            ctx.fillStyle = fallback; ctx.fillRect(x-size/2, y-size/2, size, size);
        }
    }

    updateUI() {
        document.getElementById('hud-level').innerText = this.player.lvl;
        document.getElementById('hud-hp').innerText = Math.floor(this.player.hp);
        document.getElementById('hud-max-hp').innerText = this.player.maxHp;
        document.getElementById('shop-points-hud').innerText = this.player.sp;
    }
}

const game = new Game();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Guerra dos automatos</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; left: 10px; pointer-events: none; z-index: 5; }
        .stat { background: rgba(0,0,0,0.8); padding: 8px 15px; margin-bottom: 5px; border-left: 4px solid #00d2ff; font-weight: bold; }
        #boss-hud { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 50%; display: none; text-align: center; }
        #bar-bg { width: 100%; height: 10px; background: #333; border: 1px solid #fff; margin-top: 5px; }
        #bar-fill { width: 100%; height: 100%; background: red; transition: width 0.1s; }
        #menu { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        .btn { background: #0077ff; border: none; padding: 15px 40px; color: white; cursor: pointer; border-radius: 50px; font-size: 1.2rem; }
        #shop { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 20; }
        .upgrade-grid { display: flex; gap: 20px; margin-bottom: 30px; }
        .card { background: #222; border: 2px solid #444; padding: 20px; text-align: center; cursor: pointer; width: 120px; }
        .card:hover { border-color: #00d2ff; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="stat">üõ°Ô∏è N√çVEL: <span id="txt-lvl">1</span></div>
        <div class="stat">‚ù§Ô∏è HP: <span id="txt-hp">100</span></div>
        <div class="stat">üèÜ PONTOS: <span id="txt-sp">0</span></div>
    </div>

    <div id="boss-hud">
        <b style="color: red;">arauto do vapor</b>
        <div id="bar-bg"><div id="bar-fill"></div></div>
    </div>

    <div id="menu">
        <h1>Guerra dos automatos</h1>
        <button class="btn" onclick="game.start()">INICIAR OPERA√á√ÉO</button>
    </div>

    <div id="shop">
        <h2 style="color: gold;">UPGRADES DISPON√çVEIS</h2>
        <div class="upgrade-grid">
            <div class="card" onclick="game.buy('dmg')"><h3>DANO</h3><p>Custo: 1</p></div>
            <div class="card" onclick="game.buy('fr')"><h3>VEL. TIRO</h3><p>Custo: 1</p></div>
            <div class="card" onclick="game.buy('hp')"><h3>REPARO</h3><p>Custo: 1</p></div>
        </div>
        <button class="btn" onclick="game.closeShop()">VOLTAR</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
/** CARREGAMENTO DE IMAGENS **/
const img = {
    player: new Image(), enemy: new Image(), boss: new Image(),
    wall: new Image(), bullet: new Image(), ammo: new Image()
};
img.player.src = 'assets/player.png';
img.enemy.src = 'assets/enemy_robot.png';
img.boss.src = 'assets/boss_robot.png';
img.wall.src = 'assets/scrap_block.png';
img.bullet.src = 'assets/bullet.png';
img.ammo.src = 'assets/ammo.png';

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

class Game {
    constructor() {
        this.p = { x: 0, y: 0, hp: 100, maxHp: 100, lvl: 1, xp: 0, xpNext: 100, sp: 0, dmg: 25, fr: 15, cd: 0, size: 22 };
        this.enemies = []; this.bullets = []; this.walls = []; this.drops = [];
        this.boss = null; this.keys = {}; this.running = false;
        
        window.addEventListener('keydown', e => this.keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => this.keys[e.key.toLowerCase()] = false);
        window.addEventListener('mousedown', () => this.isShooting = true);
        window.addEventListener('mouseup', () => this.isShooting = false);
        window.addEventListener('mousemove', e => { this.mx = e.clientX; this.my = e.clientY; });
    }

    start() {
        this.p.x = canvas.width/2; this.p.y = canvas.height/2;
        this.generateMap();
        this.running = true;
        document.getElementById('menu').style.display = 'none';
        this.loop();
    }

    generateMap() {
        this.walls = [];
        for(let i=0; i<8; i++) {
            this.walls.push({ x: Math.random()*(canvas.width-100)+50, y: Math.random()*(canvas.height-100)+50, w: 60, h: 60 });
        }
    }

    loop() {
        if (!this.running) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        this.updatePlayer();
        this.updateEnemies();
        this.updateBullets();
        this.updateDrops();
        this.drawWalls();
        this.updateUI();

        requestAnimationFrame(() => this.loop());
    }

    updatePlayer() {
        // Movimento
        if (this.keys['w']) this.p.y -= 5;
        if (this.keys['s']) this.p.y += 5;
        if (this.keys['a']) this.p.x -= 5;
        if (this.keys['d']) this.p.x += 5;

        // Teleporte (Screen Wrap)
        if (this.p.x < 0) this.p.x = canvas.width;
        else if (this.p.x > canvas.width) this.p.x = 0;
        if (this.p.y < 0) this.p.y = canvas.height;
        else if (this.p.y > canvas.height) this.p.y = 0;

        // Tiro
        if (this.p.cd > 0) this.p.cd--;
        if (this.isShooting && this.p.cd <= 0) {
            const angle = Math.atan2(this.my - this.p.y, this.mx - this.p.x);
            this.bullets.push({ x: this.p.x, y: this.p.y, vx: Math.cos(angle)*12, vy: Math.sin(angle)*12, type: 'p' });
            this.p.cd = this.p.fr;
        }

        ctx.drawImage(img.player, this.p.x - 25, this.p.y - 25, 50, 50);
    }

    updateEnemies() {
        // L√≥gica do Boss
        if (this.p.lvl % 5 === 0 && !this.boss) {
            this.boss = { x: canvas.width/2, y: -100, hp: 1000 + (this.p.lvl * 200), maxHp: 1000 + (this.p.lvl * 200), size: 80 };
            document.getElementById('boss-hud').style.display = 'block';
        }

        if (this.boss) {
            if (this.boss.y < 120) this.boss.y += 2;
            this.boss.x += Math.sin(Date.now()/1000) * 3;
            ctx.drawImage(img.boss, this.boss.x - this.boss.size, this.boss.y - this.boss.size, this.boss.size*2, this.boss.size*2);
            document.getElementById('bar-fill').style.width = (this.boss.hp / this.boss.maxHp * 100) + '%';
        } else {
            // Inimigos Normais
            if (Math.random() < 0.02 && this.enemies.length < 15) {
                this.enemies.push({ x: Math.random()*canvas.width, y: -50, hp: 50 });
            }
        }

        for (let i = this.enemies.length - 1; i >= 0; i--) {
            const e = this.enemies[i];
            const angle = Math.atan2(this.p.y - e.y, this.p.x - e.x);
            e.x += Math.cos(angle) * 2.5;
            e.y += Math.sin(angle) * 2.5;

            ctx.drawImage(img.enemy, e.x - 20, e.y - 20, 40, 40);

            if (Math.hypot(this.p.x - e.x, this.p.y - e.y) < 30) {
                this.p.hp -= 0.5;
                if (this.p.hp <= 0) location.reload();
            }
        }
    }

    updateBullets() {
        for (let i = this.bullets.length - 1; i >= 0; i--) {
            const b = this.bullets[i];
            b.x += b.vx; b.y += b.vy;
            ctx.drawImage(img.bullet, b.x - 8, b.y - 8, 16, 16);

            // Colis√£o Boss
            if (this.boss && Math.hypot(b.x - this.boss.x, b.y - this.boss.y) < this.boss.size) {
                this.boss.hp -= this.p.dmg;
                this.bullets.splice(i, 1);
                if (this.boss.hp <= 0) {
                    this.boss = null; this.p.xp += 500; this.checkLvl();
                    document.getElementById('boss-hud').style.display = 'none';
                    this.drops.push({ x: canvas.width/2, y: canvas.height/2 });
                }
                continue;
            }

            // Colis√£o Inimigos
            this.enemies.forEach((e, ei) => {
                if (Math.hypot(b.x - e.x, b.y - e.y) < 25) {
                    e.hp -= this.p.dmg;
                    this.bullets.splice(i, 1);
                    if (e.hp <= 0) { 
                        this.enemies.splice(ei, 1); 
                        this.p.xp += 20; 
                        this.checkLvl(); 
                    }
                }
            });

            if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) this.bullets.splice(i, 1);
        }
    }

    drawWalls() {
        this.walls.forEach(w => ctx.drawImage(img.wall, w.x, w.y, w.w, w.h));
    }

    updateDrops() {
        for (let i = this.drops.length - 1; i >= 0; i--) {
            const d = this.drops[i];
            ctx.drawImage(img.ammo, d.x - 15, d.y - 15, 30, 30);
            if (Math.hypot(this.p.x - d.x, this.p.y - d.y) < 30) {
                this.p.hp = Math.min(this.p.maxHp, this.p.hp + 30);
                this.drops.splice(i, 1);
            }
        }
    }

    checkLvl() {
        if (this.p.xp >= this.p.xpNext) {
            this.p.lvl++; this.p.xp = 0; this.p.sp++;
            this.running = false;
            document.getElementById('shop').style.display = 'flex';
        }
    }

    buy(type) {
        if (this.p.sp > 0) {
            this.p.sp--;
            if (type === 'dmg') this.p.dmg += 15;
            if (type === 'fr') this.p.fr = Math.max(5, this.p.fr - 2);
            if (type === 'hp') this.p.hp = this.p.maxHp;
            this.updateUI();
        }
    }

    closeShop() {
        document.getElementById('shop').style.display = 'none';
        this.running = true;
        this.loop();
    }

    updateUI() {
        document.getElementById('txt-lvl').innerText = this.p.lvl;
        document.getElementById('txt-hp').innerText = Math.ceil(this.p.hp);
        document.getElementById('txt-sp').innerText = this.p.sp;
    }
}

const game = new Game();
</script>
</body>
</html>
